import asyncio
import logging
from aiogram import Bot, Dispatcher, types
from aiogram.enums import ParseMode
from aiogram.types import Message
from aiogram.filters import CommandStart, Command
from aiogram.client.bot import DefaultBotProperties
import random

API_TOKEN = "–¢–æ–∫–µ–Ω–í–∞—à–µ–≥–æ–¢–µ–ª–µ–≥—Ä–∞–º–ë–æ—Ç–∞"

logging.basicConfig(level=logging.INFO)

bot = Bot(token=API_TOKEN, default=DefaultBotProperties(parse_mode=ParseMode.HTML))
dp = Dispatcher()

SYMPTOM_DB = {
    "–≥–æ—Ä–ª–æ": [
        {"disease": "—Ñ–∞—Ä–∏–Ω–≥–∏—Ç", "probability": 70, "treatment": "–ü–æ–ª–æ—Å–∫–∞–Ω–∏–µ –≥–æ—Ä–ª–∞ —Å–æ–ª—ë–Ω–æ–π –≤–æ–¥–æ–π, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏."},
        {"disease": "–∞–Ω–≥–∏–Ω–∞", "probability": 50, "treatment": "–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏, –æ—Ç–¥—ã—Ö –∏ –æ–±–∏–ª—å–Ω–æ–µ –ø–∏—Ç—å—ë."},
        {"disease": "–û–†–í–ò", "probability": 60, "treatment": "–ñ–∞—Ä–æ–ø–æ–Ω–∏–∂–∞—é—â–∏–µ, –æ—Ç–¥—ã—Ö, –º–Ω–æ–≥–æ –∂–∏–¥–∫–æ—Å—Ç–∏."},
        {"disease": "–ª–∞—Ä–∏–Ω–≥–∏—Ç", "probability": 60, "treatment": "–û—Ç–¥—ã—Ö, –ø–æ–∫–æ–π –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–≤—è–∑–æ–∫, –∏–Ω–≥–∞–ª—è—Ü–∏–∏."},
        {"disease": "—Ç–æ–Ω–∑–∏–ª–ª–∏—Ç", "probability": 65, "treatment": "–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏, –ø–æ–ª–æ—Å–∫–∞–Ω–∏–µ, –ø–æ–∫–æ–π."}
    ],
    "–≥–æ–ª–æ–≤–∞": [
        {"disease": "–º–∏–≥—Ä–µ–Ω—å", "probability": 80, "treatment": "–û–±–µ–∑–±–æ–ª–∏–≤–∞—é—â–∏–µ, —Ç–µ–º–Ω–æ—Ç–∞, –ø–æ–∫–æ–π."},
        {"disease": "—Å—Ç—Ä–µ—Å—Å", "probability": 60, "treatment": "–†–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ, –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, –≤–æ–∑–º–æ–∂–Ω–æ —É—Å–ø–æ–∫–æ–∏—Ç–µ–ª—å–Ω—ã–µ."},
        {"disease": "–æ–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ", "probability": 50, "treatment": "–†–µ–≥–∏–¥—Ä–∞—Ç–∞—Ü–∏—è (–ø–∏—Ç—å –º–Ω–æ–≥–æ –≤–æ–¥—ã)."},
        {"disease": "–≥–∏–ø–µ—Ä—Ç–æ–Ω–∏—è", "probability": 75, "treatment": "–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–∞–≤–ª–µ–Ω–∏—è, –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –æ—Ç –≥–∏–ø–µ—Ä—Ç–æ–Ω–∏–∏."},
        {"disease": "—Å–æ—Ç—Ä—è—Å–µ–Ω–∏–µ –º–æ–∑–≥–∞", "probability": 50, "treatment": "–û—Ç–¥—ã—Ö, –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ, –≤–æ–∑–º–æ–∂–Ω–æ –≥–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è."}
    ],
    "—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞": [
        {"disease": "–≥—Ä–∏–ø–ø", "probability": 90, "treatment": "–ñ–∞—Ä–æ–ø–æ–Ω–∏–∂–∞—é—â–∏–µ, –æ—Ç–¥—ã—Ö, –º–Ω–æ–≥–æ –∂–∏–¥–∫–æ—Å—Ç–∏."},
        {"disease": "–û–†–í–ò", "probability": 60, "treatment": "–ü–æ–ª–æ—Å–∫–∞–Ω–∏–µ –≥–æ—Ä–ª–∞, –∂–∞—Ä–æ–ø–æ–Ω–∏–∂–∞—é—â–∏–µ."},
        {"disease": "—Ç–æ–∫—Å–∏–Ω–æ–≤—ã–µ –∏–Ω—Ñ–µ–∫—Ü–∏–∏", "probability": 40, "treatment": "–û–±–∏–ª—å–Ω–æ–µ –ø–∏—Ç—å—ë, –æ—Ç–¥—ã—Ö, –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏."},
        {"disease": "–ø–Ω–µ–≤–º–æ–Ω–∏—è", "probability": 80, "treatment": "–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏, –æ–±–∏–ª—å–Ω–æ–µ –ø–∏—Ç—å—ë, –ø–æ–∫–æ–π."},
        {"disease": "—Å–µ–ø—Å–∏—Å", "probability": 30, "treatment": "–ù–µ–æ—Ç–ª–æ–∂–Ω–∞—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ø–æ–º–æ—â—å, –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏, –≥–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è."}
    ],
    "–Ω–µ–¥–æ—Å—ã–ø": [
        {"disease": "–∞—Å—Ç–µ–Ω–∏—è", "probability": 70, "treatment": "–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ —Å–Ω–∞, –æ—Ç–¥—ã—Ö, –≤–∏—Ç–∞–º–∏–Ω–∏–∑–∞—Ü–∏—è."},
        {"disease": "–ø–µ—Ä–µ–≥–æ—Ä–∞–Ω–∏–µ", "probability": 60, "treatment": "–ü—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–∏—è, –æ—Ç–¥—ã—Ö, —Ä–∞–±–æ—Ç–∞ —Å —Ä–µ–∂–∏–º–æ–º."},
        {"disease": "–¥–µ–ø—Ä–µ—Å—Å–∏—è", "probability": 50, "treatment": "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–º–æ—â—å, –∞–Ω—Ç–∏–¥–µ–ø—Ä–µ—Å—Å–∞–Ω—Ç—ã, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞."},
        {"disease": "—Å–∏–Ω–¥—Ä–æ–º —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–ª–æ—Å—Ç–∏", "probability": 60, "treatment": "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–º–æ—â—å, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ —Å–Ω–∞."},
        {"disease": "–Ω–∞—Ä—É—à–µ–Ω–∏–µ —Ü–∏—Ä–∫–∞–¥–Ω—ã—Ö —Ä–∏—Ç–º–æ–≤", "probability": 55, "treatment": "–ö–æ—Ä—Ä–µ–∫—Ü–∏—è —Ä–µ–∂–∏–º–∞ —Å–Ω–∞, –ø—Ä–∏—ë–º –º–µ–ª–∞—Ç–æ–Ω–∏–Ω–∞."}
    ],
    "—Ä–≤–æ—Ç–∞": [
        {"disease": "–ø–∏—â–µ–≤–æ–µ –æ—Ç—Ä–∞–≤–ª–µ–Ω–∏–µ", "probability": 80, "treatment": "–ü–∏—Ç—å—ë —Ä–µ–≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–∞—Å—Ç–≤–æ—Ä–æ–≤, –ø–æ–∫–æ–π."},
        {"disease": "–≤–∏—Ä—É—Å–Ω–∞—è –∏–Ω—Ñ–µ–∫—Ü–∏—è", "probability": 70, "treatment": "–û–±–∏–ª—å–Ω–æ–µ –ø–∏—Ç—å—ë, –∞–Ω—Ç–∏—Å–µ–ø—Ç–∏–∫–∏, –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏ (–µ—Å–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ –≤—Ä–∞—á–æ–º)."},
        {"disease": "–≥–∞—Å—Ç—Ä–∏—Ç", "probability": 60, "treatment": "–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏, —Å—Ç—Ä–æ–≥–∞—è –¥–∏–µ—Ç–∞."},
        {"disease": "—è–∑–≤–∞ –∂–µ–ª—É–¥–∫–∞", "probability": 70, "treatment": "–î–∏–µ—Ç–∞, –∞–Ω—Ç–∏—Å–µ–∫—Ä–µ—Ç–æ—Ä–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞, –≤–æ–∑–º–æ–∂–Ω–æ –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏."},
        {"disease": "–ø–∞–Ω–∫—Ä–µ–∞—Ç–∏—Ç", "probability": 65, "treatment": "–ù—É–ª–µ–≤–æ–π —Ä–µ–∂–∏–º (–æ—Ç–∫–∞–∑ –æ—Ç –µ–¥—ã), –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–∞—Ä—É –¥–Ω–µ–π."}
    ],
    "—Å–æ–Ω–ª–∏–≤–æ—Å—Ç—å": [
        {"disease": "–Ω–µ–¥–æ—Å—ã–ø–∞–Ω–∏–µ", "probability": 85, "treatment": "–†–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–æ–Ω, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞."},
        {"disease": "–∞–Ω–µ–º–∏—è", "probability": 50, "treatment": "–ü—Ä–∏—ë–º –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ –∂–µ–ª–µ–∑–∞, –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –ø–∏—Ç–∞–Ω–∏—è."},
        {"disease": "—Å–∏–Ω–¥—Ä–æ–º —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–ª–æ—Å—Ç–∏", "probability": 60, "treatment": "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–º–æ—â—å, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ —Å–Ω–∞."},
        {"disease": "–≥–∏–ø–æ—Ç–∏—Ä–µ–æ–∑", "probability": 65, "treatment": "–õ–µ—á–µ–Ω–∏–µ —â–∏—Ç–æ–≤–∏–¥–Ω–æ–π –∂–µ–ª–µ–∑—ã, –≥–æ—Ä–º–æ–Ω–∞–ª—å–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è."},
        {"disease": "–¥–µ–ø—Ä–µ—Å—Å–∏—è", "probability": 50, "treatment": "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–º–æ—â—å, –∞–Ω—Ç–∏–¥–µ–ø—Ä–µ—Å—Å–∞–Ω—Ç—ã."}
    ],
    "–±–æ–ª—å –≤ –º—ã—à—Ü–∞—Ö": [
        {"disease": "–º–∏–æ–∑–∏—Ç", "probability": 75, "treatment": "–ü—Ä–æ—Ç–∏–≤–æ–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã, –æ—Ç–¥—ã—Ö, —Ñ–∏–∑–∏–æ—Ç–µ—Ä–∞–ø–∏—è."},
        {"disease": "—Ç—Ä–∞–≤–º–∞", "probability": 60, "treatment": "–ü–æ–∫–æ–π, –ª–µ–¥ –Ω–∞ –º–µ—Å—Ç–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è, –æ–±–µ–∑–±–æ–ª–∏–≤–∞—é—â–∏–µ."},
        {"disease": "—Ñ–∏–±—Ä–æ–º–∏–∞–ª–≥–∏—è", "probability": 50, "treatment": "–ê–Ω—Ç–∏–¥–µ–ø—Ä–µ—Å—Å–∞–Ω—Ç—ã, —Ñ–∏–∑–∏–æ—Ç–µ—Ä–∞–ø–∏—è, —Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è."}
    ],
    "—Å–ø–∞–∑–º—ã": [
        {"disease": "—Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏—è", "probability": 70, "treatment": "–î–∏–µ—Ç–∞, —Å–ø–∞–∑–º–æ–ª–∏—Ç–∏–∫–∏."},
        {"disease": "–æ–ø—É—Ö–æ–ª—å", "probability": 50, "treatment": "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞, –≤–æ–∑–º–æ–∂–Ω–æ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ."},
        {"disease": "–ø–∏—â–µ–≤–æ–¥–Ω—ã–π —Ä–µ—Ñ–ª—é–∫—Å", "probability": 60, "treatment": "–ê–Ω—Ç–∞—Ü–∏–¥—ã, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è."}
    ],
    "–∫–æ–ª—é—â–∞—è –±–æ–ª—å –≤ –æ–±–ª–∞—Å—Ç–∏ –≥—Ä—É–¥–∏": [
        {"disease": "–∏–Ω—Ñ–∞—Ä–∫—Ç –º–∏–æ–∫–∞—Ä–¥–∞", "probability": 90, "treatment": "–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –≤—Ä–∞—á—É, –≥–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è."},
        {"disease": "–ø–Ω–µ–≤–º–æ–Ω–∏—è", "probability": 65, "treatment": "–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏, –æ–±–∏–ª—å–Ω–æ–µ –ø–∏—Ç—å—ë, –ø–æ–∫–æ–π."},
        {"disease": "–º–µ–∂—Ä–µ–±–µ—Ä–Ω–∞—è –Ω–µ–≤—Ä–∞–ª–≥–∏—è", "probability": 70, "treatment": "–ü—Ä–æ—Ç–∏–≤–æ–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã, —Ñ–∏–∑–∏–æ—Ç–µ—Ä–∞–ø–∏—è."}
    ],
}

@dp.message(CommandStart())
async def cmd_start(message: Message):
    await message.answer("üëã –ü—Ä–∏–≤–µ—Ç! –ù–∞–ø–∏—à–∏ —Å–≤–æ–∏ —Å–∏–º–ø—Ç–æ–º—ã, –∞ —è –ø–æ–º–æ–≥—É –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑.\n\n"
                         "–¢—ã –º–æ–∂–µ—à—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:\n"
                         "/symptoms - –°–ø–∏—Å–æ–∫ —Å–∏–º–ø—Ç–æ–º–æ–≤\n"
                         "/help - –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞")

@dp.message(Command("symptoms"))
async def cmd_symptoms(message: Message):
    symptoms = "–í–æ—Ç —Å–ø–∏—Å–æ–∫ —Å–∏–º–ø—Ç–æ–º–æ–≤, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —è –º–æ–≥—É –ø–æ–º–æ—á—å:\n"
    for symptom in SYMPTOM_DB.keys():
        symptoms += f"- {symptom}\n"
    await message.answer(symptoms)

@dp.message(Command("help"))
async def cmd_help(message: Message):
    await message.answer(
        "–Ø –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏–º–ø—Ç–æ–º–æ–≤.\n"
        "–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–∏ —Å–∏–º–ø—Ç–æ–º—ã, –∏ —è –ø—Ä–µ–¥–ª–æ–∂—É –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥–∏–∞–≥–Ω–æ–∑—ã. –í–æ—Ç –ø—Ä–∏–º–µ—Ä:\n"
        "'–£ –º–µ–Ω—è –±–æ–ª–∏—Ç –≥–æ—Ä–ª–æ –∏ –≥–æ–ª–æ–≤–∞.'\n"
        "–¢–∞–∫–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã:\n"
        "/symptoms - –°–ø–∏—Å–æ–∫ —Å–∏–º–ø—Ç–æ–º–æ–≤\n"
        "/help - –ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞"
    )

@dp.message()
async def diagnose(message: Message):
    text = message.text.lower()
    diagnoses = []
    treatments = []
    probabilities = []

    for keyword, possible_diseases in SYMPTOM_DB.items():
        if keyword in text:
            for disease in possible_diseases:
                diagnoses.append(disease["disease"])
                treatments.append(disease["treatment"])
                probabilities.append(disease["probability"])

    if diagnoses:
        response = "ü§î –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ:\n"
        for i, disease in enumerate(set(diagnoses)):
            response += f"\n- {disease} (–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: {probabilities[i]}%)"
            response += f"\n  –°–ø–æ—Å–æ–± –ª–µ—á–µ–Ω–∏—è: {treatments[i]}"

        response += "\n\n–ù–æ —ç—Ç–æ –Ω–µ —Ç–æ—á–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑, –∏ —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –≤—Ä–∞—á—É –¥–ª—è —Ç–æ—á–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏!"
    else:
        response = "üòï –ù–µ —Å–º–æ–≥ –Ω–∏—á–µ–≥–æ —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ —ç—Ç–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é. –ú–æ–∂–µ—Ç –±—ã—Ç—å, —ç—Ç–æ –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ –º–æ–π —Å–ø–∏—Å–æ–∫."

    await message.answer(response)

async def main():
    await bot.delete_webhook(drop_pending_updates=True)
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
